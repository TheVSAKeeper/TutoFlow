@page "/sharding/app-level"
@rendermode InteractiveServer

@inject ShardingApiClient ShardingApi

<PageTitle>Application-Level Sharding</PageTitle>

<h1>Demo 2: Application-Level Sharding</h1>

<p>
    –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —à–∞—Ä–¥–∏–Ω–≥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ PostgreSQL (<code>shard-alpha</code>, <code>shard-beta</code>).
    <code>ShardManager</code> –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Ü–µ–Ω—Ç—Ä—ã –ø–æ —á—ë—Ç–Ω–æ—Å—Ç–∏ ID: —á—ë—Ç–Ω—ã–µ ‚Üí alpha, –Ω–µ—á—ë—Ç–Ω—ã–µ ‚Üí beta.
</p>

<div class="mb-3">
    <div class="btn-group" role="group">
        <button class="btn btn-primary" @onclick="InitAsync" disabled="@_isLoading">
            üèóÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —à–∞—Ä–¥—ã
        </button>
        <button class="btn btn-success" @onclick="SeedAsync" disabled="@_isLoading">
            üå± –°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä—ã (@_seedCount —à—Ç.)
        </button>
        <button class="btn btn-info" @onclick="GetStatsAsync" disabled="@_isLoading">
            üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </button>
        <button class="btn btn-danger" @onclick="ResetAsync" disabled="@_isLoading">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
        </button>
    </div>
</div>

<div class="row mb-3">
    <div class="col-auto">
        <label for="seedCount" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–Ω—Ç—Ä–æ–≤:</label>
        <input id="seedCount" type="number" class="form-control" style="max-width: 200px" @bind="_seedCount" min="1"
               max="100" />
    </div>
    <div class="col-auto">
        <label for="queryId" class="form-label">ID —Ü–µ–Ω—Ç—Ä–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞:</label>
        <div class="input-group" style="max-width: 300px">
            <input id="queryId" type="number" class="form-control" @bind="_queryCenterId" min="1" />
            <button class="btn btn-outline-primary" @onclick="QueryCenterAsync" disabled="@_isLoading">
                üîç –ù–∞–π—Ç–∏
            </button>
        </div>
    </div>
</div>

@if (_isLoading)
{
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
}

@if (!string.IsNullOrEmpty(_lastResult))
{
    <div class="card mt-3">
        <div class="card-header">
            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç</strong>
        </div>
        <div class="card-body">
            <pre class="mb-0" style="white-space: pre-wrap; max-height: 500px; overflow-y: auto;">@_lastResult</pre>
        </div>
    </div>
}

@if (!string.IsNullOrEmpty(_errorMessage))
{
    <div class="alert alert-danger mt-3">@_errorMessage</div>
}
